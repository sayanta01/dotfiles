sudo pacman -S --noconfirm --needed linux-lts linux-lts-headers
sudo grub-mkconfig -o /boot/grub/grub.cfg

sudo pacman -S --noconfirm --needed nvidia-dkms nvidia-utils nvidia-settings
# lib32-nvidia-utils opencl-nvidia nvtop

params="nvidia_drm.modeset=1"
if ! grep -q $params /etc/default/grub; then
	sudo sed -i "/^GRUB_CMDLINE_LINUX_DEFAULT=/s/'\(.*\)'/'\1 $params'/" /etc/default/grub
	sudo grub-mkconfig -o /boot/grub/grub.cfg
fi

echo "options nvidia_drm modeset=1" | sudo tee /etc/modprobe.d/nvidia.conf

nvidia_modules="nvidia nvidia_modeset nvidia_uvm nvidia_drm"
sudo sed -i -E 's/ nvidia_drm//g; s/ nvidia_uvm//g; s/ nvidia_modeset//g; s/ nvidia//g;' /etc/mkinitcpio.conf
sudo sed -i -E "s/^(MODULES=\()/\1${nvidia_modules} /" /etc/mkinitcpio.conf
sudo mkinitcpio -P

# https://github.com/korvahannu/arch-nvidia-drivers-installation-guide
# https://wiki.hypr.land/Nvidia/
# steam setting > downloads > disable shader pre-caching
# Fix Screen Tearing in X11
