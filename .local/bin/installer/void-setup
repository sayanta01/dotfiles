#!/bin/sh

# sudo xbps-install -Su
sudo xbps-install -Sy void-repo-nonfree void-repo-multilib void-repo-multilib-nonfree
sudo xbps-install -Sy base-devel linux-firmware vim zsh tmux xorg NetworkManager xfce4-plugins

cp -r ~/dotfiles/{.bashrc,.bash_profile,.profile,.zprofile,.xprofile,.xinitrc,.imwheelrc,.vimrc} ~/
mkdir "$HOME/.local/bin"
cp -r ~/dotfiles/.local/bin/* ~/.local/bin && cp -r ~/dotfiles/.local/share/* ~/.local/share && cp -r ~/dotfiles/.config/. ~/.config
chmod -R +x ~/.config/bspwm/ ~/.config/polybar/launch.sh ~/.config/sxhkd/sxhkd.sh ~/.local/bin/ ~/.config/sxiv/ ~/.config/lf/{scope,cleaner}
mkdir ~/{desk,dox,dl,music,vids,pix,templates,pub,code,imp}

printf "Fonts? (yes/no): "
read -r choice

if [ "$choice" = "yes" ]; then
	# Maple-font
	mver="v6.4"
	wget https://github.com/subframe7536/Maple-font/releases/download/$mver/MapleMono-NF.zip
	yes | sudo unzip MapleMono-NF.zip -d /usr/share/fonts/TTF
	# Nerd-fonts
	latest_nf="v3.0.2"
	wget https://github.com/ryanoasis/nerd-fonts/releases/download/$latest_nf/CascadiaCode.zip
	yes | sudo unzip JetBrainsMono.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/download/$latest_nf/JetBrainsMono.zip
	yes | sudo unzip JetBrainsMono.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/download/$latest_nf/Cousine.zip
	yes | sudo unzip JetBrainsMono.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/download/$latest_nf/FiraCode.zip
	yes | sudo unzip JetBrainsMono.zip -d /usr/share/fonts/TTF
	fc-cache -fv
	rm -rf MapleMono-NF.zip CascadiaCode.zip JetBrainsMono.zip Cousine.zip FiraCode.zip
else
	:
fi

# Suckless
sudo xbps-install -Sy libXft-devel harfbuzz-devel libXinerama-devel
git clone --depth=1 https://github.com/LukeSmithxyz/st.git ~/dl/st
cd ~/dl/st && sudo make clean install
git clone --depth=1 https://github.com/LukeSmithxyz/dmenu.git ~/dl/dmenu
cd ~/dl/dmenu && sudo make clean install

# My nvim config
git clone --depth=1 https://github.com/sayanta01/nvim ~/.config/nvim
# Tpm
git clone --depth=1 https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm

# Themes
git clone --depth=1 https://github.com/sayanta01/Papirus-FlatMix ~/.local/share/icons/PapirusFlatMix
sudo cp -r ~/.local/share/icons/Papirus-FlatMix /usr/share/icons
sudo cp -r ~/.local/share/themes/* /usr/share/themes
sudo cp -r ~/.local/share/fonts /usr/share/fonts/local-fonts

sudo xbps-install -Sy font-awesome \
	noto-fonts-ttf noto-fonts-emoji noto-fonts-cjk terminus-font \
	exa bat tldr fd ripgrep procs duf dust man-db fzf bash-completion starship zoxide \
	mate-calc firefox qutebrowser meld \
	linux-headers kitty newsboat trash-cli neovim \
	neofetch htop cowsay gnome-keyring \
	bspwm polybar sxhkd rofi dunst picom \
	qt5ct qt6ct kvantum lxappearance xcape \
	playerctl pulsemixer pavucontrol mpd ncmpcpp python3-dbus \
	cmake wmname imwheel pass \
	wireless_tools net-tools network-manager-applet bind-utils iftop nmap \
	mpv mediainfo exiftool ffmpegthumbnailer ImageMagick maim sxiv xwallpaper ffmpeg python3-pip pywal \
	zip unzip unrar p7zip engrampa \
	ncdu lf gvfs Thunar thunar-archive-plugin thunar-media-tags-plugin \
	zathura zathura-pdf-mupdf ghostscript \
	zsh-syntax-highlighting zsh-completions zsh-autosuggestions \
	rsync wget aria2 yt-dlp transmission jq \
	xdg-utils xdg-user-dirs xdo xclip xdotool colorpicker wmctrl unclutter powershell
# socat exfat-utils  - additional tools

# Check CPU vendor
cpu_vendor=$(grep vendor_id /proc/cpuinfo | uniq | awk -F ': ' '{print $2}')

if [ "$cpu_vendor" = "GenuineIntel" ]; then
	sudo xbps-install -Sy intel-ucode
elif [ "$cpu_vendor" = "AuthenticAMD" ]; then
	sudo xbps-install -Sy amd-ucode
else
	echo "Unsupported CPU vendor"
fi

# Audio server
sudo pacman -S pipewire wireplumber libspa-bluetooth
# sudo pacman -S pulseaudio

# Check Nvidia GPU
if lspci | grep -i nvidia; then
	sudo xbps-install -Sy nvidia nvidia-libs-32bit nvtop glmark2
else
	echo "No NVIDIA GPU detected"
fi

# GUI apps
sudo xbps-install -Sy scrcpy android-tools stress bpytop \
	obs blender audacity gimp inkscape \
	kdeconnect telegram-desktop \
	blueman bluez ntfs-3g
# virtualbox-ose virtualbox-ose-guest

# VM
sudo xbps-install -Sy qemu virt-manager dnsmasq bridge-utils openbsd-netcat swtpm libvirt openssh docker

sudo xbps-install -Sy betterlockscreen xwinwrap \
	vscode anki simple-mtpfs anki cava

# xbps-src
git clone --depth=1 https://github.com/void-linux/void-packages ~/.local/share/void-packages
cd ~/.local/share/void-packages && ./xbps-src binary-bootstrap
echo XBPS_ALLOW_RESTRICTED=yes > etc/conf

# Google-chrome
cd ~/.local/share/void-packages && ./xbps-src pkg google-chrome
sudo xbps-install -y --repository=hostdir/binpkgs/nonfree google-chrome

# Change Teletype font
echo 'FONT="ter-d16b"' | sudo tee -a /etc/rc.conf
