#!/bin/sh

# yes | sudo apt full-upgrade
dots=".bashrc .bash_profile .profile .zprofile .xprofile .xinitrc .imwheelrc .vimrc"
for file in $dots; do
	cp -r ~/dotfiles/"$file" ~/
done
mkdir "$HOME/.local/bin"
cp -r ~/dotfiles/.local/bin/* ~/.local/bin && cp -r ~/dotfiles/.local/share/* ~/.local/share && cp -r ~/dotfiles/.config/. ~/.config
chmod -R +x ~/.config/bspwm/ ~/.config/polybar/launch.sh ~/.config/sxhkd/sxhkd.sh ~/.local/bin/ ~/.config/sxiv/ ~/.config/lf/
for dir in desk dox dl music vids pix templates pub code imp; do
	mkdir ~/"$dir"
done

printf "Fonts? (y/n): "
read -r choice

if [ "$choice" = "y" ]; then
	# Maple-font
	wget https://github.com/subframe7536/Maple-font/releases/latest/download/MapleMono-NF.zip
	yes | sudo unzip MapleMono-NF.zip -d /usr/share/fonts/TTF
	# Nerd-fonts
	wget https://github.com/ryanoasis/nerd-fonts/releases/latest/download/JetBrainsMono.zip
	yes | sudo unzip JetBrainsMono.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/latest/download/Cousine.zip
	yes | sudo unzip Cousine.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/latest/download/FiraCode.zip
	yes | sudo unzip FiraCode.zip -d /usr/share/fonts/TTF
	wget https://github.com/ryanoasis/nerd-fonts/releases/latest/download/CascadiaCode.zip
	yes | sudo unzip CascadiaCode.zip -d /usr/share/fonts/TTF
	fc-cache -fv
	rm -rf MapleMono-NF.zip JetBrainsMono.zip Cousine.zip FiraCode.zip CascadiaCode.zip
else
	:
fi

# Suckless
sudo apt install -y libxft-dev librust-harfbuzz-rs-dev libxinerama-dev libx11-xcb-dev libxcb-res0-dev
git clone --depth=1 https://github.com/sayanta01/st.git ~/dl/st
cd ~/dl/st && sudo make clean install
git clone --depth=1 https://github.com/sayanta01/dmenu.git ~/dl/dmenu
cd ~/dl/dmenu && sudo make clean install

# My nvim config
git clone --depth=1 https://github.com/sayanta01/nvim ~/.config/nvim
# Tpm
git clone --depth=1 https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm

# Themes
git clone --depth=1 https://github.com/sayanta01/Papirus-FlatMix ~/.local/share/icons/Papirus-FlatMix
sudo cp -r ~/.local/share/icons/Papirus-FlatMix /usr/share/icons
sudo cp -r ~/.local/share/themes/* /usr/share/themes
sudo cp -r ~/.local/share/fonts /usr/share/fonts/local-fonts

sudo apt install -y nala apt-transport-https \
	zsh zsh-syntax-highlighting zsh-autosuggestions \
	tmux fonts-terminus \
	fonts-noto fonts-noto-color-emoji fonts-noto-cjk \
	bspwm polybar rofi kitty dunst maim playerctl pulsemixer \
	ffmpeg mpv sxiv exa fzf fd-find \
	zathura htop lxappearance meld \
	imwheel xclip xdo xdotool xwallpaper gpg xcape \
	exiftool aria2 wmname wmctrl neofetch \
	transmission-daemon trash-cli \
	docker.io ssh iftop net-tools
# lf betterlockscreen ncdu translate-shell
# sudo systemctl enable docker.socket
sudo systemctl enable ssh.socket

yes | curl -sS https://starship.rs/install.sh | sh

# wget 'https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64' -O ~/dl/vscode.deb
# aria2c -x9 -o PacketTracer.deb -d ~/dl https://archive.org/download/packet-tracer-800-build-212-mac-notarized/PacketTracer_800_amd64_build212_final.deb
# cd ~/dl && chmod +x PacketTracer.deb && sudo dpkg -i PacketTracer.deb

distro=$(grep ID= /etc/os-release | sed -n 2p | cut -d= -f2)
if [ "$distro" = "ubuntu" ] || [ "$distro" = "kali" ] || [ "$distro" = "debian" ]; then
	sed -i 's/^# source \/usr\/share\/zsh-syntax-highlighting\/zsh-syntax-highlighting.zsh/source \/usr\/share\/zsh-syntax-highlighting\/zsh-syntax-highlighting.zsh/' ~/.config/zsh/.zshrc
	sed -i 's/^# source \/usr\/share\/zsh-autosuggestions\/zsh-autosuggestions.zsh/source \/usr\/share\/zsh-autosuggestions\/zsh-autosuggestions.zsh/' ~/.config/zsh/.zshrc
else
	:
fi

# Fix debian
sudo ln -s /usr/bin/fdfind /usr/bin/fd
sudo apt purge xfce4-clipman catfish onboard xterm cherrytree plymouth

distro=$(lsb_release -a | awk -F ':\t' '/Distributor ID/ {print $2}')
[ "$distro" = "Kali" ] && sudo apt purge qterminal kali-hidpi-mode

distro=$(grep ID= /etc/os-release | sed -n 2p | cut -d= -f2)
if [ "$distro" = "ubuntu" ] || [ "$distro" = "kali" ]; then
	if ! grep -q "source ~/.profile" ~/.config/zsh/.zshrc; then
		echo "source ~/.profile" >> ~/.config/zsh/.zshrc
	fi
	ln -s ~/.config/zsh/.zshrc ~/.zshrc
	ln -s ~/.config/x11/xinitrc ~/.xinitrc
else
	:
fi

# Console font
# sudo dpkg-reconfigure console-setup

# sudo systemd-analyze # Boot time info
# sudo su root -c "echo deb https://mirrors.ocf.berkeley.edu/kali kali-rolling main contrib non-free >> /etc/apt/sources.list"
